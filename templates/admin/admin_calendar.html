{% extends 'base.html' %}
{% load i18n static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container-fluid my-5">
    <div class="card shadow-sm">
        <div class="card-header text-center">
            <h1 class="h3 mb-3">{{ page_title }}</h1>

            <div class="d-flex justify-content-center align-items-center gap-3">
                <button id="previous-btn" class="btn btn-outline-secondary">‹ {% translate "Previous" %}</button>
                <h2 id="calendar-title" class="h4 mb-0 text-center" style="width: 200px;"></h2>
                <button id="next-btn" class="btn btn-outline-secondary">{% translate "Next" %} ›</button>
            </div>
        </div>

        <div class="card-body">
            <div id="dp_month"></div>
        </div>
    </div>
</div>
{% endblock content %}

{% block scripts %}
<script src="{% static 'daypilot/daypilot-all.min.js' %}"></script>
{% get_current_language as lang_code %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const prevButton = document.getElementById("previous-btn");
    const nextButton = document.getElementById("next-btn");
    const title = document.getElementById("calendar-title");

    // --- Pass Django's language to JavaScript ---
    let lang = "{{ lang_code }}";
    if (lang === "pt") {
        lang = "pt-pt"; // Use the specific locale for Portuguese (Portugal)
    }

    const dp = new DayPilot.Month("dp_month");

    // --- SET THE LOCALE HERE ---
    dp.locale = lang;

    // Configuration
    dp.eventHeight = 25;
    dp.onEventClick = args => {
        const bookingId = args.e.id();
        window.location.href = `/my-bookings/${bookingId}/`;
    };
    dp.onTimeRangeSelected = (args) => {
        title.innerText = dp.startDate.toString("MMMM yyyy", dp.locale); // Use the locale for formatting
    };

    // Button listeners remain the same
    prevButton.addEventListener("click", () => {
        dp.startDate = dp.startDate.addMonths(-1);
        dp.update();
    });
    nextButton.addEventListener("click", () => {
        dp.startDate = dp.startDate.addMonths(1);
        dp.update();
    });

    dp.init();

    // Set the initial title
    title.innerText = dp.startDate.toString("MMMM yyyy", dp.locale);

    dp.events.load("{% url 'booking_app:booking_api' %}");
});
</script>
{% endblock scripts %}
